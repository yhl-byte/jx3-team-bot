from nonebot import on_regex
from nonebot.adapters.onebot.v11 import GroupMessageEvent, Bot
import random
from typing import List

# 食物推荐命令
food_recommend = on_regex(pattern=r"^(吃什么|今天吃什么|吃啥|推荐食物)$", priority=5)
# 饮品推荐命令
drink_recommend = on_regex(pattern=r"^(喝什么|今天喝什么|喝啥|推荐饮品)$", priority=5)

# 庞大的食物数据库
FOOD_DATABASE = {
    "中式菜品": [
        "宫保鸡丁", "麻婆豆腐", "回锅肉", "鱼香肉丝", "糖醋里脊", "红烧肉", "东坡肉", "白切鸡",
        "口水鸡", "辣子鸡", "水煮鱼", "酸菜鱼", "清蒸鲈鱼", "红烧鲤鱼", "蒜蓉扇贝", "白灼虾",
        "油焖大虾", "蒜蓉粉丝蒸扇贝", "清炒时蔬", "干煸四季豆", "地三鲜", "醋溜白菜", "蚂蚁上树",
        "担担面", "重庆小面", "兰州拉面", "刀削面", "炸酱面", "热干面", "螺蛳粉", "桂林米粉",
        "过桥米线", "沙县小吃", "煎饼果子", "肉夹馍", "羊肉泡馍", "胡辣汤", "豆腐脑", "小笼包",
        "生煎包", "灌汤包", "韭菜盒子", "锅贴", "饺子", "馄饨", "汤圆", "粽子", "年糕", "糍粑",
        "麻辣香锅", "干锅花菜", "水煮牛肉", "毛血旺", "口水鸡", "夫妻肺片", "棒棒鸡", "白斩鸡"
    ],
    "西式料理": [
        "意大利面", "披萨", "汉堡", "牛排", "羊排", "烤鸡", "炸鸡", "薯条", "洋葱圈", "凯撒沙拉",
        "蔬菜沙拉", "水果沙拉", "土豆泥", "烤土豆", "奶油蘑菇汤", "番茄汤", "玉米浓汤", "三明治",
        "热狗", "培根", "香肠", "芝士蛋糕", "提拉米苏", "布丁", "马卡龙", "可颂", "贝果", "华夫饼",
        "班尼迪克蛋", "欧姆蛋", "煎蛋", "炒蛋", "水波蛋", "法式吐司", "松饼", "司康饼", "甜甜圈",
        "芝士焗饭", "奶油意面", "肉酱意面", "海鲜意面", "烤羊腿", "烤猪排", "烤鸭胸", "鹅肝"
    ],
    "日韩料理": [
        "寿司", "刺身", "天妇罗", "拉面", "乌冬面", "荞麦面", "亲子丼", "牛肉丼", "鳗鱼饭", "章鱼烧",
        "大阪烧", "铁板烧", "烤肉", "火锅", "关东煮", "味噌汤", "茶碗蒸", "手卷", "军舰寿司",
        "韩式烤肉", "石锅拌饭", "冷面", "泡菜", "韩式炸鸡", "部队锅", "参鸡汤", "海鲜煎饼", "紫菜包饭",
        "韩式拌面", "辣炒年糕", "韩式火锅", "烤五花肉", "韩式烤牛肉", "韩式汤面", "韩式煎饺",
        "日式咖喱", "猪排饭", "鸡排饭", "日式炒面", "韩式烤鱼", "韩式海鲜汤", "韩式豆腐汤"
    ],
    "东南亚料理": [
        "泰式炒河粉", "冬阴功汤", "绿咖喱", "红咖喱", "芒果糯米饭", "泰式沙拉", "椰汁鸡", "泰式烤鱼",
        "越南河粉", "越南春卷", "越南咖啡", "新加坡炒米粉", "海南鸡饭", "叻沙", "马来咖喱", "印尼炒饭",
        "沙爹", "椰浆饭", "菲律宾烤乳猪", "印度咖喱", "印度飞饼", "印度烤鸡", "马德拉斯咖喱",
        "泰式酸辣汤", "椰子鸡汤", "泰式烤虾", "越南烤肉", "印尼烤鸡", "马来烤鱼", "新加坡肉骨茶"
    ],
    "街头小吃": [
        "烤冷面", "手抓饼", "煎饼果子", "鸡蛋灌饼", "肉夹馍", "凉皮", "擀面皮", "米皮", "酿皮",
        "烤红薯", "烤玉米", "烤土豆", "烤茄子", "烤韭菜", "烤豆腐", "烤面筋", "烤肠", "烤鸡翅",
        "炸鸡柳", "炸鸡排", "炸串", "烤串", "麻辣烫", "关东煮", "臭豆腐", "豆腐脑", "胡辣汤",
        "糖葫芦", "棉花糖", "爆米花", "煮玉米", "茶叶蛋", "卤蛋", "咸鸭蛋", "皮蛋", "松花蛋",
        "铁板鱿鱼", "铁板豆腐", "铁板土豆", "铁板年糕", "章鱼小丸子", "鸡蛋仔", "车轮饼", "红豆饼",
        "煎饺", "锅贴", "生煎包", "小笼包", "灌汤包", "韭菜盒子", "春卷", "蛋挞", "烧饼", "油条",
        "豆浆", "粥", "八宝粥", "小馄饨", "酸辣粉", "凉粉", "凉面", "担担面", "热干面", "刀削面",
        "烤面包", "烤吐司", "三明治", "汉堡", "热狗", "薯条", "洋葱圈", "鸡米花", "爆米花鸡",
        "炸薯条", "炸鸡块", "炸鱼排", "炸虾", "炸蘑菇", "炸花菜", "炸茄盒", "炸藕盒", "炸春卷"
    ],
    "传统小食": [
        "粽子", "汤圆", "年糕", "糍粑", "青团", "艾草团子", "豆沙包", "莲蓉包", "奶黄包", "叉烧包",
        "流沙包", "水晶包", "虾饺", "烧卖", "凤爪", "排骨", "牛肉丸", "鱼丸", "虾丸", "墨鱼丸",
        "白切鸡", "口水鸡", "辣子鸡", "宫保鸡丁", "糖醋里脊", "红烧肉", "东坡肉", "白斩鸡",
        "盐水鸭", "板鸭", "腊肉", "香肠", "咸菜", "泡菜", "酸菜", "榨菜", "咸鸭蛋", "皮蛋"
    ]
}

# 饮品数据库（包含各大品牌）
DRINK_DATABASE = {
    "奶茶品牌": {
        "喜茶": [
            "芝芝莓莓", "芝芝桃桃", "芝芝芒芒", "多肉葡萄", "满杯红柚", "金凤茶王", "绿妍", "茉莉毛尖",
            "四季春", "阿华田波波茶", "豆豆波波茶", "芝芝莓果茶", "芝芝葡萄", "芝芝柠檬", "烤黑糖波波茶",
            "芝芝蜜桃", "芝芝草莓", "芝芝西柚", "芝芝荔枝", "芝芝百香果", "芝芝凤梨", "芝芝椰子"
        ],
        "奈雪的茶": [
            "霸气橙子", "霸气葡萄", "霸气芝士草莓", "霸气芝士蜜桃", "霸气芝士葡萄", "霸气杨梅", "霸气车厘子",
            "霸气芝士芒果", "霸气芝士柠檬", "霸气芝士西柚", "霸气芝士荔枝", "霸气芝士百香果", "霸气芝士凤梨",
            "霸气芝士椰子", "霸气芝士蓝莓", "霸气芝士火龙果", "霸气芝士猕猴桃", "霸气芝士石榴", "霸气芝士樱桃"
        ],
        "一点点": [
            "波霸奶茶", "珍珠奶茶", "红茶玛奇朵", "绿茶玛奇朵", "四季奶青", "阿华田", "可可芭蕾", "养乐多绿茶",
            "柠檬蜜", "百香果汁", "柠檬养乐多", "梅子绿茶", "冰淇淋红茶", "布丁奶茶", "椰果奶茶",
            "仙草奶茶", "红豆奶茶", "绿豆沙奶茶", "芋头奶茶", "抹茶奶茶", "巧克力奶茶", "草莓奶茶"
        ],
        "CoCo都可": [
            "珍珠奶茶", "布丁奶茶", "椰果奶茶", "双拼奶茶", "三兄弟", "奶茶三兄弟", "柠檬蜜", "百香双响炮",
            "芒果QQ", "草莓QQ", "柠檬养乐多", "金桔柠檬", "蜂蜜柚子茶", "冰淇淋奶茶", "焦糖奶茶",
            "香芋奶茶", "红豆奶茶", "绿豆奶茶", "花生奶茶", "杏仁奶茶", "核桃奶茶", "黑糖奶茶"
        ],
        "茶颜悦色": [
            "幽兰拿铁", "声声乌龙", "桂花弄", "抹茶菩提", "红豆布丁", "烟花易冷", "筝筝纸鸢", "浮云沉香",
            "蔓越莓司康", "柠檬绿茶", "茉莉花茶", "乌龙茶", "红茶拿铁", "抹茶拿铁", "焦糖玛奇朵",
            "茶颜悦色", "人间烟火", "凤栖梧", "蝶恋花", "满江红", "水调歌头", "念奴娇", "定风波"
        ],
        "古茗": [
            "烧仙草奶茶", "双拼奶茶", "珍珠奶茶", "布丁奶茶", "椰果奶茶", "红豆奶茶", "绿豆奶茶", "芋圆奶茶",
            "仙草冻奶茶", "龟苓膏奶茶", "豆花奶茶", "银耳奶茶", "莲子奶茶", "百合奶茶", "薏米奶茶",
            "黑糖珍珠奶茶", "黑糖布丁奶茶", "黑糖椰果奶茶", "黑糖红豆奶茶", "黑糖芋圆奶茶"
        ],
        "蜜雪冰城": [
            "珍珠奶茶", "布丁奶茶", "椰果奶茶", "红豆奶茶", "绿豆奶茶", "芋圆奶茶", "仙草奶茶", "双拼奶茶",
            "柠檬水", "百香果茶", "柠檬茶", "蜂蜜柚子茶", "金桔柠檬", "西瓜汁", "芒果汁", "草莓汁",
            "冰淇淋", "圣代", "奶昔", "果汁", "气泡水", "苏打水", "柠檬苏打", "百香果苏打"
        ],
        "书亦烧仙草": [
            "烧仙草奶茶", "芋圆烧仙草", "珍珠烧仙草", "布丁烧仙草", "椰果烧仙草", "红豆烧仙草", "绿豆烧仙草",
            "花生烧仙草", "莲子烧仙草", "银耳烧仙草", "百合烧仙草", "薏米烧仙草", "龟苓膏烧仙草",
            "豆花烧仙草", "仙草冻烧仙草", "黑糖烧仙草", "蜂蜜烧仙草", "红糖烧仙草", "冰糖烧仙草"
        ],
        "茶百道": [
            "超级杯", "大满贯", "招牌奶茶", "珍珠奶茶", "布丁奶茶", "椰果奶茶", "红豆奶茶", "绿豆奶茶",
            "芋圆奶茶", "仙草奶茶", "双拼奶茶", "三拼奶茶", "四拼奶茶", "五拼奶茶", "六拼奶茶",
            "柠檬茶", "百香果茶", "蜂蜜柚子茶", "金桔柠檬", "西瓜汁", "芒果汁", "草莓汁", "蓝莓汁"
        ],
        "沪上阿姨": [
            "现煮五谷茶", "血糯米奶茶", "紫米奶茶", "红豆奶茶", "绿豆奶茶", "花生奶茶", "核桃奶茶",
            "杏仁奶茶", "芝麻奶茶", "燕麦奶茶", "薏米奶茶", "莲子奶茶", "银耳奶茶", "百合奶茶",
            "桂圆奶茶", "红枣奶茶", "枸杞奶茶", "山药奶茶", "茯苓奶茶", "当归奶茶", "人参奶茶"
        ]
    },
    "咖啡品牌": {
        "星巴克": [
            "美式咖啡", "拿铁", "卡布奇诺", "摩卡", "焦糖玛奇朵", "香草拿铁", "榛果拿铁", "抹茶拿铁",
            "冰美式", "冰拿铁", "冰摩卡", "星冰乐", "抹茶星冰乐", "焦糖星冰乐", "香草星冰乐", "咖啡星冰乐",
            "椰子拿铁", "燕麦拿铁", "杏仁拿铁", "豆奶拿铁", "无糖拿铁", "低脂拿铁", "脱脂拿铁"
        ],
        "瑞幸咖啡": [
            "生椰拿铁", "厚乳拿铁", "燕麦拿铁", "丝绒拿铁", "陨石拿铁", "小鹿茶", "气泡美式", "椰云拿铁",
            "榛果拿铁", "香草拿铁", "焦糖玛奇朵", "摩卡", "美式咖啡", "冰美式", "热美式", "冰拿铁",
            "生椰美式", "厚乳美式", "燕麦美式", "杏仁美式", "豆奶美式", "椰子美式", "榛果美式"
        ],
        "Costa": [
            "美式咖啡", "拿铁", "卡布奇诺", "摩卡", "焦糖拿铁", "香草拿铁", "榛果拿铁", "白咖啡",
            "冰美式", "冰拿铁", "冰摩卡", "冰焦糖拿铁", "热巧克力", "抹茶拿铁", "椰子拿铁",
            "燕麦拿铁", "杏仁拿铁", "豆奶拿铁", "无糖拿铁", "低脂拿铁", "脱脂拿铁", "半糖拿铁"
        ],
        "太平洋咖啡": [
            "美式咖啡", "拿铁", "卡布奇诺", "摩卡", "焦糖玛奇朵", "香草拿铁", "榛果拿铁", "白咖啡",
            "冰美式", "冰拿铁", "冰摩卡", "冰焦糖拿铁", "抹茶拿铁", "椰子拿铁", "燕麦拿铁",
            "杏仁拿铁", "豆奶拿铁", "无糖拿铁", "低脂拿铁", "脱脂拿铁", "半糖拿铁", "三分糖拿铁"
        ],
        "Manner咖啡": [
            "美式咖啡", "拿铁", "卡布奇诺", "摩卡", "焦糖拿铁", "香草拿铁", "榛果拿铁", "椰子拿铁",
            "燕麦拿铁", "杏仁拿铁", "豆奶拿铁", "冰美式", "冰拿铁", "冰摩卡", "冰焦糖拿铁",
            "手冲咖啡", "精品咖啡", "单品咖啡", "意式浓缩", "长萃咖啡", "冷萃咖啡", "氮气咖啡"
        ],
        "Tims咖啡": [
            "美式咖啡", "拿铁", "卡布奇诺", "摩卡", "焦糖拿铁", "香草拿铁", "榛果拿铁", "椰子拿铁",
            "燕麦拿铁", "杏仁拿铁", "豆奶拿铁", "冰美式", "冰拿铁", "冰摩卡", "冰焦糖拿铁",
            "法式香草", "焦糖玛奇朵", "白巧克力摩卡", "黑巧克力摩卡", "肉桂拿铁", "薄荷摩卡"
        ]
    },
    "果汁饮品": [
        "鲜榨橙汁", "苹果汁", "葡萄汁", "西瓜汁", "芒果汁", "草莓汁", "蓝莓汁", "柠檬汁", "柚子汁",
        "百香果汁", "猕猴桃汁", "石榴汁", "樱桃汁", "菠萝汁", "椰子汁", "胡萝卜汁", "芹菜汁", "番茄汁",
        "混合果汁", "蔬果汁", "排毒果汁", "维C果汁", "纤维果汁", "低糖果汁", "无糖果汁",
        "火龙果汁", "哈密瓜汁", "香瓜汁", "甜瓜汁", "木瓜汁", "牛油果汁", "柿子汁", "梨汁",
        "桃汁", "杏汁", "李子汁", "枇杷汁", "荔枝汁", "龙眼汁", "山竹汁", "榴莲汁", "椰青汁"
    ],
    "传统饮品": [
        "豆浆", "酸梅汤", "绿豆汤", "银耳莲子汤", "红豆汤", "薏米水", "柠檬蜂蜜水", "蜂蜜柚子茶",
        "玫瑰花茶", "茉莉花茶", "菊花茶", "金银花茶", "薄荷茶", "柠檬茶", "蜂蜜茶", "生姜茶",
        "红枣茶", "枸杞茶", "决明子茶", "普洱茶", "铁观音", "龙井茶", "碧螺春", "大红袍", "白茶",
        "乌龙茶", "绿茶", "红茶", "黑茶", "黄茶", "花茶", "果茶", "奶茶", "酥油茶", "砖茶",
        "沱茶", "饼茶", "散茶", "袋泡茶", "速溶茶", "冰茶", "热茶", "凉茶", "药茶", "保健茶"
    ],
    "气泡饮品": [
        "可乐", "雪碧", "芬达", "百事可乐", "七喜", "美年达", "苏打水", "气泡水", "柠檬苏打",
        "百香果苏打", "草莓苏打", "蓝莓苏打", "芒果苏打", "西瓜苏打", "葡萄苏打", "橙子苏打",
        "柚子苏打", "荔枝苏打", "龙眼苏打", "椰子苏打", "菠萝苏打", "猕猴桃苏打", "石榴苏打"
    ]
}

def get_random_foods() -> List[str]:
    """随机获取3种食物"""
    all_foods = []
    for category, foods in FOOD_DATABASE.items():
        all_foods.extend(foods)
    
    return random.sample(all_foods, min(3, len(all_foods)))

def get_random_drinks() -> List[str]:
    """随机获取3种饮品"""
    all_drinks = []
    
    # 从奶茶品牌中获取
    for brand, drinks in DRINK_DATABASE["奶茶品牌"].items():
        all_drinks.extend([f"{brand} - {drink}" for drink in drinks])
    
    # 从咖啡品牌中获取
    for brand, drinks in DRINK_DATABASE["咖啡品牌"].items():
        all_drinks.extend([f"{brand} - {drink}" for drink in drinks])
    
    # 添加果汁、传统饮品和气泡饮品
    all_drinks.extend(DRINK_DATABASE["果汁饮品"])
    all_drinks.extend(DRINK_DATABASE["传统饮品"])
    all_drinks.extend(DRINK_DATABASE["气泡饮品"])
    
    return random.sample(all_drinks, min(3, len(all_drinks)))

def get_food_tips() -> str:
    """获取随机美食小贴士"""
    tips = [
        "🍽️ 记得营养搭配，荤素结合哦！",
        "🥗 多吃蔬菜水果，身体更健康！",
        "🍚 适量主食，为身体提供能量！",
        "🥛 别忘了补充水分和蛋白质！",
        "🌶️ 少油少盐少糖，清淡饮食更健康！",
        "🍎 饭前吃水果，有助于消化！",
        "🥜 坚果类食物富含优质脂肪！",
        "🐟 鱼类富含Omega-3，对大脑有益！",
        "🥕 彩色蔬菜营养更丰富！",
        "🍵 饭后喝茶有助于消化！"
    ]
    return random.choice(tips)

def get_drink_tips() -> str:
    """获取随机饮品小贴士"""
    tips = [
        "🥤 适量饮用，避免过量糖分摄入！",
        "💧 多喝白开水，是最好的饮品！",
        "🍵 茶类饮品有抗氧化作用！",
        "🥛 牛奶富含钙质，有助骨骼健康！",
        "🍋 柠檬水富含维生素C！",
        "🥥 椰子水天然电解质丰富！",
        "🍯 蜂蜜水有润燥的功效！",
        "🌿 薄荷茶有清热解毒的作用！",
        "🫖 温开水最养胃，冷饮要适量！",
        "🧊 夏天喝冰饮要注意肠胃健康！"
    ]
    return random.choice(tips)

@food_recommend.handle()
async def handle_food_recommend(bot: Bot, event: GroupMessageEvent):
    """处理食物推荐"""
    try:
        # 获取随机食物
        foods = get_random_foods()
        
        # 构建推荐消息
        message = "🍽️ 今天吃什么呢？为你推荐：\n\n"
        for i, food in enumerate(foods, 1):
            message += f"{i}. {food}\n"
        
        # 添加美食小贴士
        message += f"\n{get_food_tips()}"
        
        # 发送消息
        await food_recommend.send(message)
            
    except Exception as e:
        await food_recommend.send("❌ 推荐失败，请稍后再试")
        print(f"食物推荐错误: {e}")

@drink_recommend.handle()
async def handle_drink_recommend(bot: Bot, event: GroupMessageEvent):
    """处理饮品推荐"""
    try:
        # 获取随机饮品
        drinks = get_random_drinks()
        
        # 构建推荐消息
        message = "🥤 今天喝什么呢？为你推荐：\n\n"
        for i, drink in enumerate(drinks, 1):
            message += f"{i}. {drink}\n"
        
        # 添加饮品小贴士
        message += f"\n{get_drink_tips()}"
        
        # 发送消息
        await drink_recommend.send(message)
            
    except Exception as e:
        await drink_recommend.send("❌ 推荐失败，请稍后再试")
        print(f"饮品推荐错误: {e}")